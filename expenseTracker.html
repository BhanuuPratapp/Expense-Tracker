


<!DOCTYPE html>
<html lang="en">
    <head>


        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Forms</title>


    </head>


<body>
  <form onsubmit="saveToLocalStorage(event)">
    <label> Expanse amount </label>
    <input id="expanseamount" type="text"  name="amount" required/>
    <label> Choose description </label>
    <input id="description" type="text"  name="chooseDescription" required/>
    <label> Choose Category </label>
    <select name="Languages" id="category">
      <option value="">--Please choose an category--</option>
      <option value="Movies" >Movies</option>
      <option value="Health and Safety">Health and Safety</option>
      <option value="Gardening">Gardening</option>
      <option value="Decoration">Decoration</option>
      <option value="Cleanng">Cleaning</option>
    </select>   
    <button> Submit </button>
  </form>
<ul id="listofCategories"></ul>

<button id="rzp-button1">Buy Premium</button>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.3/axios.min.js"></script>
  <script>

  async function saveToLocalStorage(event){
    try{
    event.preventDefault();
   const expanseAmount = event.target.expanseamount.value;
   const Description = event.target.description.value;
   const Category = event.target.category.value;
   
   const obj = {
     expanseAmount,
     Description,
     Category
   }
   const token = localStorage.getItem('token');
 
   
   let result = await axios.post("http://localhost:1000/user/add-users",obj,{headers: {"Authorization": token}})
    
     console.log("bhanuuuuuuuu")   
        showListOfRegistered(result.data.newUserDetail);
    
               
                 
                       //console.log(response2)
}             
                   catch(err)  {
                    document.body.innerHTML = document.body.innerHTML + "<h4>Error: Somethiiiiiing Not found</h4>" 
                   console.log(err)
  }
   //localStorage.setItem(obj.Category,JSON.stringify(obj));
   //showListOfRegistered(obj)

}

  window.addEventListener('DOMContentLoaded', async (event) => {
  try{
   const token = localStorage.getItem('token')
  let response = await axios.get("http://localhost:1000/user/get-users",{headers: {"Authorization": token}})
                
                        for(i=0;i<response.data.allUsers.length;i++){
                        showListOfRegistered(response.data.allUsers[i]);
                      }
                    }                     

                      catch(err) {console.log(err)}
   // Object.keys(localStorage).forEach(key => {
     //   const category = JSON.parse(localStorage.getItem(key));
        //console.log(JSON.parse(localStorage.getItem(key)))
       // showListOfRegistered(category); 

})

function showListOfRegistered(categories){
  
   document.getElementById('expanseamount').value = '';
    document.getElementById('description').value = '';
    document.getElementById('category').value = '';
    
    /*
    if(localStorage.getItem(categories.Category) !== null){

        removeRegistered(categories.Category);
    }
    */
    var parentNode4 = document.getElementById('listofCategories');

    var childNode4 = `<li id=${categories.id}> ${categories.expenseamount} ${categories.description} ${categories.category} <button onclick = deleteRegistered('${categories.id}')>Delete</button> <button onclick = editRegistered('${encodeURIComponent(categories.expenseamount)}','${encodeURIComponent(categories.description)}','${encodeURIComponent(categories.category)}','${categories.id}')>Edit</button> </li>`
    parentNode4.innerHTML = parentNode4.innerHTML + childNode4;
}

function editRegistered(expanse1, amount1, category, id)
{
console.log(id)
document.getElementById('expanseamount').value = decodeURIComponent(expanse1);
document.getElementById('description').value = decodeURIComponent(amount1);
document.getElementById('category').value = decodeURIComponent(category);

deleteRegistered(id)
}

async function deleteRegistered(ID){
  try{

   
  removeRegistered(ID);
  await axios.delete(`http://localhost:1000/user/delete-users/${ID}`)

  }   
            
 catch(err) {console.log(err)}


   // localStorage.removeItem(cate);
    //removeRegistered(cate);
}


function removeRegistered(IDs){

  var parentNode1 = document.getElementById('listofCategories');
                    const childNodeToBeDeleted2 = document.getElementById(IDs);
                   // console.log(category2)
                   // console.log(childNodeToBeDeleted)
                    if(childNodeToBeDeleted2)
                    {
                    parentNode1.removeChild(childNodeToBeDeleted2);
                    }

}


document.getElementById('rzp-button1').onclick = async function (e) {
    const token = localStorage.getItem('token');
    const response  = await axios.get('http://localhost:1000/purchase/premiummembership', { headers: {"Authorization" : token} });
    console.log(response);
    var options =
    {
     "key": response.data.key_id, // Enter the Key ID generated from the Dashboard
     "name": "Test Company",
     "order_id": response.data.order.id, // For one time payment
     "prefill": {
       "name": "Test User",
       "email": "test.user@example.com",
       "contact": "7003442036"
     },
     "theme": {
      "color": "#3399cc"
     },
     // This handler function will handle the success payment
     "handler": function (response) {
         console.log(response);
         axios.post('http://localhost:1000/purchase/updatetransactionstatus',{
             order_id: options.order_id,
             payment_id: response.razorpay_payment_id,
         }, { headers: {"Authorization" : token} }).then(() => {
             alert('You are a Premium User Now')
         }).catch(() => {
             alert('Something went wrong. Try Again!!!')
         })
     },
  };
  const rzp1 = new Razorpay(options);
  rzp1.open();
  e.preventDefault();

  rzp1.on('payment.failed', function (response){
  alert(response.error.code);
  alert(response.error.description);
  alert(response.error.source);
  alert(response.error.step);
  alert(response.error.reason);
  alert(response.error.metadata.order_id);
  alert(response.error.metadata.payment_id);
 });
}

</script>
</body>
</html>